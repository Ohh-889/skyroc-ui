# Carousel 轮播图

轮播图组件用于循环展示一组内容，支持水平和垂直方向，基于 Embla Carousel 构建。

## 安装

<InstallDependencies packages={['embla-carousel-react']} />

可选插件：

```bash
# 自动播放
npm add embla-carousel-autoplay

# 自动滚动
npm add embla-carousel-auto-scroll

# 类名切换
npm add embla-carousel-class-names
```

## 导入

```ts copy
import { 
  Carousel,
  CarouselRoot,
  CarouselContent,
  CarouselItem,
  CarouselPrevious,
  CarouselNext
} from 'skyroc-ui';
```

## 基础用法

### 基本示例

通过 `counts` 指定项目数量，使用函数渲染每个项目。

<Demo src="@playground/carousel/modules/CarouselBasic" title="基本轮播图" />

### 多项显示

通过 `classNames.item` 的 `basis` 类控制每次显示的项目数量。

<Demo src="@playground/carousel/modules/CarouselMultiple" title="多项显示" />

### 自动播放

使用 `embla-carousel-autoplay` 插件实现自动播放功能。

<Demo src="@playground/carousel/modules/CarouselAutoplay" title="自动播放" />

### 垂直方向

通过 `orientation="vertical"` 设置为垂直方向滚动。

<Demo src="@playground/carousel/modules/CarouselVertical" title="垂直轮播图" />

## 组合式 API

如果需要更灵活的布局控制，可以使用组合式 API：

```tsx
import {
  CarouselRoot,
  CarouselContent,
  CarouselItem,
  CarouselPrevious,
  CarouselNext
} from 'skyroc-ui';

export default function Demo() {
  return (
    <CarouselRoot opts={{ loop: true }}>
      <CarouselContent>
        <CarouselItem>
          <div>Slide 1</div>
        </CarouselItem>
        <CarouselItem>
          <div>Slide 2</div>
        </CarouselItem>
        <CarouselItem>
          <div>Slide 3</div>
        </CarouselItem>
      </CarouselContent>
      <CarouselPrevious />
      <CarouselNext />
    </CarouselRoot>
  );
}
```

## API

### Carousel Props

简化的轮播图组件，封装了所有子组件。

| 属性 | 类型 | 默认值 | 说明 |
|------|------|--------|------|
| counts | `number` | - | 项目数量 |
| children | `(index: number) => ReactNode \| ReactNode[]` | - | 渲染函数或子元素数组 |
| orientation | `'horizontal' \| 'vertical'` | `'horizontal'` | 滚动方向 |
| opts | `CarouselOptions` | - | Embla Carousel 选项 |
| plugins | `CarouselPlugin[]` | - | Embla Carousel 插件 |
| setApi | `(api: CarouselApi) => void` | - | 获取 API 实例的回调 |
| size | `'xs' \| 'sm' \| 'md' \| 'lg' \| 'xl' \| '2xl'` | `'md'` | 尺寸 |
| classNames | `CarouselUi` | - | 自定义各部分的样式类名 |
| className | `ClassValue` | - | 根容器自定义类名 |
| nextProps | `ButtonProps` | - | 下一个按钮的属性 |
| previousProps | `ButtonProps` | - | 上一个按钮的属性 |

> 支持原生 `div` 元素的其他所有属性。

### CarouselUi（classNames）

| 属性 | 类型 | 说明 |
|------|------|------|
| root | `ClassValue` | 根容器样式 |
| content | `ClassValue` | 内容容器样式 |
| contentWrapper | `ClassValue` | 内容包裹器样式 |
| item | `ClassValue` | 项目样式 |
| previous | `ClassValue` | 上一个按钮样式 |
| next | `ClassValue` | 下一个按钮样式 |

### CarouselOptions

Embla Carousel 的配置选项，常用选项：

| 属性 | 类型 | 默认值 | 说明 |
|------|------|--------|------|
| loop | `boolean` | `false` | 是否循环滚动 |
| align | `'start' \| 'center' \| 'end'` | `'center'` | 对齐方式 |
| dragFree | `boolean` | `false` | 自由拖拽模式 |
| containScroll | `false \| 'trimSnaps' \| 'keepSnaps'` | `'trimSnaps'` | 滚动边界行为 |
| slidesToScroll | `number \| 'auto'` | `1` | 每次滚动的项目数 |
| startIndex | `number` | `0` | 起始索引 |
| duration | `number` | `25` | 动画时长（值越大越慢） |

更多选项请参考 [Embla Carousel 文档](https://www.embla-carousel.com/api/options/)。

### CarouselRoot Props

轮播图的根容器组件。

| 属性 | 类型 | 默认值 | 说明 |
|------|------|--------|------|
| orientation | `'horizontal' \| 'vertical'` | `'horizontal'` | 滚动方向 |
| opts | `CarouselOptions` | - | Embla Carousel 选项 |
| plugins | `CarouselPlugin[]` | - | Embla Carousel 插件 |
| setApi | `(api: CarouselApi) => void` | - | 获取 API 实例的回调 |
| className | `ClassValue` | - | 自定义类名 |

> 支持原生 `div` 元素的其他所有属性。

### CarouselContent Props

轮播图内容容器组件。

| 属性 | 类型 | 默认值 | 说明 |
|------|------|--------|------|
| classNames | `{ content, contentWrapper }` | - | 自定义样式 |
| className | `ClassValue` | - | 自定义类名 |

> 支持原生 `div` 元素的其他所有属性。

### CarouselItem Props

轮播图项目组件。

| 属性 | 类型 | 默认值 | 说明 |
|------|------|--------|------|
| className | `ClassValue` | - | 自定义类名 |

> 支持原生 `div` 元素的其他所有属性。

### CarouselPrevious / CarouselNext Props

轮播图导航按钮，继承 Button 组件的所有属性。

| 属性 | 类型 | 默认值 | 说明 |
|------|------|--------|------|
| className | `ClassValue` | - | 自定义类名 |

> 支持 Button 组件的其他所有属性。

## 常用插件

### 自动播放

```tsx
import Autoplay from 'embla-carousel-autoplay';

<Carousel
  plugins={[
    Autoplay({ 
      delay: 2000,        // 间隔时间（毫秒）
      stopOnInteraction: true,  // 用户交互后停止
      stopOnMouseEnter: true    // 鼠标悬停时停止
    })
  ]}
>
  {/* ... */}
</Carousel>
```

### 自动滚动

```tsx
import AutoScroll from 'embla-carousel-auto-scroll';

<Carousel
  plugins={[
    AutoScroll({ 
      speed: 1,           // 滚动速度
      startDelay: 1000    // 开始延迟
    })
  ]}
>
  {/* ... */}
</Carousel>
```

## 使用指南

### 何时使用

- 图片轮播展示
- 产品展示
- 推荐内容滚动
- 横幅广告

### 响应式项目数量

通过 Tailwind 的响应式类控制不同屏幕下的显示数量：

```tsx
<Carousel
  classNames={{ 
    item: 'basis-full sm:basis-1/2 md:basis-1/3 lg:basis-1/4' 
  }}
  counts={12}
>
  {/* ... */}
</Carousel>
```

### 控制 API

通过 `setApi` 获取 Embla Carousel 的 API 实例，实现更多自定义控制：

```tsx
'use client';

import { useState, useEffect } from 'react';
import type { CarouselApi } from 'skyroc-ui';

export default function Demo() {
  const [api, setApi] = useState<CarouselApi>();
  const [current, setCurrent] = useState(0);

  useEffect(() => {
    if (!api) return;

    setCurrent(api.selectedScrollSnap());

    api.on('select', () => {
      setCurrent(api.selectedScrollSnap());
    });
  }, [api]);

  return (
    <div>
      <Carousel setApi={setApi} counts={5}>
        {/* ... */}
      </Carousel>
      <p>当前: {current + 1} / 5</p>
    </div>
  );
}
```

## 注意事项

1. **容器宽度** - 确保轮播图容器有明确的宽度
2. **项目高度** - 项目高度需要通过 `classNames.item` 或内部元素设置
3. **循环滚动** - 使用 `opts={{ loop: true }}` 启用循环
4. **插件顺序** - 多个插件时注意顺序可能影响行为
5. **客户端组件** - 使用插件时需要标记为客户端组件（'use client'）

## 无障碍

- 使用语义化的列表结构
- 导航按钮有清晰的 `aria-label`
- 支持键盘导航（左右箭头键）
- 自动播放时应提供暂停方式

## 最佳实践

### 图片轮播

```tsx
<Carousel
  counts={5}
  opts={{ loop: true }}
>
  {index => (
    <img
      src={`/images/slide-${index + 1}.jpg`}
      alt={`Slide ${index + 1}`}
      className="size-full object-cover"
    />
  )}
</Carousel>
```

### 产品卡片轮播

```tsx
<Carousel
  classNames={{ item: 'basis-full sm:basis-1/2 lg:basis-1/3' }}
  counts={products.length}
>
  {index => (
    <ProductCard product={products[index]} />
  )}
</Carousel>
```

### 带指示器的轮播

```tsx
'use client';

export default function CarouselWithDots() {
  const [api, setApi] = useState<CarouselApi>();
  const [current, setCurrent] = useState(0);
  const [count, setCount] = useState(0);

  useEffect(() => {
    if (!api) return;
    setCount(api.scrollSnapList().length);
    setCurrent(api.selectedScrollSnap());
    api.on('select', () => setCurrent(api.selectedScrollSnap()));
  }, [api]);

  return (
    <div>
      <Carousel setApi={setApi} counts={5}>
        {/* ... */}
      </Carousel>
      <div className="flex justify-center gap-2 mt-4">
        {Array.from({ length: count }).map((_, i) => (
          <button
            key={i}
            className={cn(
              'size-2 rounded-full',
              i === current ? 'bg-primary' : 'bg-muted'
            )}
            onClick={() => api?.scrollTo(i)}
          />
        ))}
      </div>
    </div>
  );
}
```

